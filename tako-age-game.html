<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸª ãŠæ­£æœˆå‡§æšã’æ•°å­—ã‚²ãƒ¼ãƒ  ğŸª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(180deg, #87CEEB 0%, #E0F6FF 50%, #98D8C8 100%);
            overflow: hidden;
            height: 100vh;
            position: relative;
        }

        /* é›²ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .cloud {
            position: absolute;
            background: white;
            border-radius: 100px;
            opacity: 0.8;
            animation: float-cloud linear infinite;
        }

        @keyframes float-cloud {
            from { transform: translateX(-200px); }
            to { transform: translateX(calc(100vw + 200px)); }
        }

        .game-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        .game-header {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 20px 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 100;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            color: #e74c3c;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .game-stats {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 10px 25px;
            border-radius: 15px;
            color: white;
            font-size: 1.3em;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .tako {
            position: absolute;
            width: 120px;
            height: 140px;
            cursor: pointer;
            transition: transform 0.3s;
            animation: sway 3s ease-in-out infinite;
        }

        .tako:hover {
            transform: scale(1.1);
        }

        @keyframes sway {
            0%, 100% { transform: translateX(-10px) rotate(-2deg); }
            50% { transform: translateX(10px) rotate(2deg); }
        }

        .tako-body {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 50%, #c44569 100%);
            position: relative;
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .tako-pattern {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            font-weight: bold;
            color: white;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
        }

        .tako-string {
            position: absolute;
            top: 100%;
            left: 50%;
            width: 2px;
            height: 200px;
            background: linear-gradient(180deg, rgba(139, 69, 19, 0.8), rgba(139, 69, 19, 0));
            transform: translateX(-50%);
            animation: string-wave 2s ease-in-out infinite;
        }

        @keyframes string-wave {
            0%, 100% { transform: translateX(-50%) rotate(0deg); }
            50% { transform: translateX(-50%) rotate(5deg); }
        }

        .tako-tail {
            position: absolute;
            top: 110%;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .tail-piece {
            width: 30px;
            height: 40px;
            background: linear-gradient(45deg, #ffd93d, #6bcf7f, #4d96ff);
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            animation: tail-flutter 1.5s ease-in-out infinite;
        }

        .tail-piece:nth-child(2) { animation-delay: 0.2s; }
        .tail-piece:nth-child(3) { animation-delay: 0.4s; }

        @keyframes tail-flutter {
            0%, 100% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
        }

        .controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            z-index: 100;
        }

        button {
            padding: 20px 40px;
            font-size: 1.5em;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
        }

        .start-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .reset-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .message-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 40px 60px;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            z-index: 200;
            display: none;
        }

        .message-box.show {
            display: block;
            animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .message-text {
            font-size: 2.5em;
            color: #e74c3c;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .particle-explosion {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            pointer-events: none;
        }

        .score-popup {
            position: absolute;
            font-size: 2em;
            font-weight: bold;
            color: #f39c12;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            pointer-events: none;
            animation: scoreFloat 1s ease-out forwards;
            z-index: 50;
        }

        @keyframes scoreFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(1.5);
            }
        }

        .difficulty-selector {
            position: absolute;
            top: 150px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 20px 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 100;
            text-align: center;
            max-width: 90%;
        }

        .difficulty-selector h3 {
            color: #667eea;
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        .mode-selector {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .mode-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 15px 30px;
            font-size: 1.2em;
            border: 3px solid transparent;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mode-btn:hover {
            transform: scale(1.05);
        }

        .mode-btn.selected {
            border-color: #e74c3c;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
        }

        .sequence-settings {
            margin-top: 15px;
            padding: 15px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 10px;
            display: none;
        }

        .sequence-settings.show {
            display: block;
        }

        .sequence-settings label {
            color: #667eea;
            font-size: 1.1em;
            font-weight: bold;
            margin-right: 10px;
        }

        .sequence-settings input {
            padding: 10px 15px;
            font-size: 1.1em;
            border: 2px solid #667eea;
            border-radius: 10px;
            width: 100px;
            text-align: center;
        }

        .difficulty-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .difficulty-btn {
            padding: 15px 30px;
            font-size: 1.2em;
            border: 3px solid transparent;
            background: linear-gradient(135deg, #ffd93d 0%, #6bcf7f 100%);
            color: white;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .difficulty-btn:hover {
            transform: scale(1.1);
        }

        .difficulty-btn.selected {
            border-color: #e74c3c;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
        }

        .direction-btn {
            padding: 10px 20px;
            font-size: 1em;
            border: 3px solid transparent;
            background: linear-gradient(135deg, #ffd93d 0%, #6bcf7f 100%);
            color: white;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .direction-btn:hover {
            transform: scale(1.05);
        }

        .direction-btn.selected {
            border-color: #e74c3c;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
        }

        .ground {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 100px;
            background: linear-gradient(180deg, #90EE90 0%, #228B22 100%);
            z-index: 10;
        }

        .mountain {
            position: absolute;
            bottom: 100px;
            width: 0;
            height: 0;
            border-left: 150px solid transparent;
            border-right: 150px solid transparent;
            border-bottom: 200px solid #8B7355;
            opacity: 0.6;
        }

        .mountain:nth-child(1) { left: 10%; }
        .mountain:nth-child(2) { right: 20%; border-bottom-color: #A0826D; }

        .fuji {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 200px solid transparent;
            border-right: 200px solid transparent;
            border-bottom: 300px solid #9370DB;
            opacity: 0.7;
        }

        .fuji::after {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 80px solid transparent;
            border-right: 80px solid transparent;
            border-bottom: 120px solid white;
        }

        .sun {
            position: absolute;
            top: 50px;
            right: 100px;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, #FFD700 0%, #FFA500 100%);
            border-radius: 50%;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.8);
            animation: sunrise 2s ease-in-out;
        }

        @keyframes sunrise {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .instruction {
            position: absolute;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 1.3em;
            color: #667eea;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }

        .level-badge {
            background: linear-gradient(135deg, #ffd93d 0%, #ff6b6b 100%);
            padding: 8px 20px;
            border-radius: 10px;
            color: white;
            font-size: 1em;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- å¤ªé™½ -->
        <div class="sun"></div>

        <!-- é›² -->
        <div class="cloud" style="top: 15%; width: 150px; height: 60px; animation-duration: 30s;"></div>
        <div class="cloud" style="top: 25%; width: 120px; height: 50px; animation-duration: 40s; animation-delay: -10s;"></div>
        <div class="cloud" style="top: 10%; width: 180px; height: 70px; animation-duration: 50s; animation-delay: -20s;"></div>

        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="game-header">
            <h1>ğŸª å‡§æšã’æ•°å­—ã‚²ãƒ¼ãƒ  ğŸª</h1>
            <div class="game-stats">
                <div class="stat-box" id="scoreBox">ã‚¹ã‚³ã‚¢: <span id="score">0</span></div>
                <div class="stat-box" id="timeBox">æ™‚é–“: <span id="time">60</span>ç§’</div>
                <div class="stat-box">é€£ç¶š: <span id="combo">0</span></div>
            </div>
            <div class="level-badge">ãƒ¬ãƒ™ãƒ«: <span id="level">1</span></div>
        </div>

        <!-- é›£æ˜“åº¦é¸æŠ -->
        <div class="difficulty-selector" id="difficultySelector">
            <!-- ãƒ¢ãƒ¼ãƒ‰é¸æŠ -->
            <div class="mode-selector">
                <h3>ãƒ¢ãƒ¼ãƒ‰ã‚’é¸ã‚“ã§ã­ï¼</h3>
                <div class="mode-buttons">
                    <button class="mode-btn selected" data-mode="timeattack">â±ï¸ ã‚¿ã‚¤ãƒ ã‚¢ã‚¿ãƒƒã‚¯<br>(60ç§’)</button>
                    <button class="mode-btn" data-mode="sequence">ğŸ“š é †ç•ªãƒ¢ãƒ¼ãƒ‰<br>(æ™‚é–“åˆ¶é™ãªã—)</button>
                </div>
                
                <!-- é †ç•ªãƒ¢ãƒ¼ãƒ‰è¨­å®š -->
                <div class="sequence-settings" id="sequenceSettings">
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 8px;">é †ç•ªã®æ–¹å‘:</label>
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <button class="direction-btn selected" id="ascendingBtn">
                                â¬†ï¸ æ˜‡é †<br>(å°â†’å¤§)
                            </button>
                            <button class="direction-btn" id="descendingBtn">
                                â¬‡ï¸ é™é †<br>(å¤§â†’å°)
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label for="startNumber">é–‹å§‹æ•°å­—:</label>
                        <input type="number" id="startNumber" value="0" min="0" max="100">
                        <span style="margin: 0 10px;">â†’</span>
                        <label for="endNumber">çµ‚äº†æ•°å­—:</label>
                        <input type="number" id="endNumber" value="9" min="0" max="100">
                    </div>
                    
                    <p style="margin-top: 10px; color: #764ba2; font-size: 0.9em;">
                        ğŸ’¡ æ˜‡é †: 0â†’1â†’2...ã€é™é †: 100â†’99â†’98...<br>
                        ğŸˆ ä¸€æ¡ã®æ•°ã ã‘å‡§ãŒå‡ºã‚‹ã‚ˆï¼ï¼ˆ5ã®æ™‚ã¯5å€‹ï¼‰
                    </p>
                </div>
            </div>

            <h3>é›£æ˜“åº¦ã‚’é¸ã‚“ã§ã­ï¼</h3>
            <div class="difficulty-buttons">
                <button class="difficulty-btn selected" data-difficulty="easy">ã‹ã‚“ãŸã‚“<br>(0-9)</button>
                <button class="difficulty-btn" data-difficulty="medium">ãµã¤ã†<br>(0-20)</button>
                <button class="difficulty-btn" data-difficulty="hard">ã‚€ãšã‹ã—ã„<br>(0-50)</button>
                <button class="difficulty-btn" data-difficulty="expert">è¶…ã‚€ãšã‹ã—ã„<br>(0-100)</button>
            </div>
        </div>

        <!-- èª¬æ˜ -->
        <div class="instruction" id="instruction">
            å‡§ã«æ›¸ã‹ã‚ŒãŸæ•°å­—ã‚’ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§å…¥åŠ›ã—ã¦ã­ï¼
        </div>

        <!-- å¯Œå£«å±±ã¨å±± -->
        <div class="fuji"></div>
        <div class="mountain"></div>
        <div class="mountain"></div>

        <!-- åœ°é¢ -->
        <div class="ground"></div>

        <!-- å‡§ãŒå…¥ã‚‹ã‚³ãƒ³ãƒ†ãƒŠ -->
        <div id="takosContainer"></div>

        <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹ -->
        <div class="message-box" id="messageBox">
            <div class="message-text" id="messageText"></div>
        </div>

        <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
        <div class="controls">
            <button class="start-btn" id="startBtn">ğŸ® ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
            <button class="reset-btn" id="resetBtn">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
    </div>

    <script>
        let score = 0;
        let timeLeft = 60;
        let combo = 0;
        let level = 1;
        let gameActive = false;
        let gameInterval;
        let spawnInterval;
        let takos = [];
        let currentInput = '';
        let difficulty = 'easy';
        let maxNumber = 9;
        let gameMode = 'timeattack'; // 'timeattack' or 'sequence'
        let sequenceNumber = 0; // é †ç•ªãƒ¢ãƒ¼ãƒ‰ã§ç¾åœ¨è¡¨ç¤ºã™ã¹ãæ•°å­—
        let startNumber = 0; // é †ç•ªãƒ¢ãƒ¼ãƒ‰ã®é–‹å§‹æ•°å­—
        let sequenceDirection = 'ascending'; // 'ascending' or 'descending'
        let endNumber = 0; // é †ç•ªãƒ¢ãƒ¼ãƒ‰ã®çµ‚äº†æ•°å­—

        const difficultySettings = {
            easy: { max: 9, spawnRate: 2000, speed: 3 },
            medium: { max: 20, spawnRate: 1500, speed: 4 },
            hard: { max: 50, spawnRate: 1200, speed: 5 },
            expert: { max: 100, spawnRate: 1000, speed: 6 }
        };

        const scoreDisplay = document.getElementById('score');
        const scoreBox = document.getElementById('scoreBox');
        const timeDisplay = document.getElementById('time');
        const timeBox = document.getElementById('timeBox');
        const comboDisplay = document.getElementById('combo');
        const levelDisplay = document.getElementById('level');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const takosContainer = document.getElementById('takosContainer');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const instruction = document.getElementById('instruction');
        const difficultySelector = document.getElementById('difficultySelector');
        const sequenceSettings = document.getElementById('sequenceSettings');
        const startNumberInput = document.getElementById('startNumber');
        const endNumberInput = document.getElementById('endNumber');
        const ascendingBtn = document.getElementById('ascendingBtn');
        const descendingBtn = document.getElementById('descendingBtn');

        // Web Audio API
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        // ãƒ¢ãƒ¼ãƒ‰é¸æŠ
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                gameMode = btn.dataset.mode;
                
                // é †ç•ªãƒ¢ãƒ¼ãƒ‰ã®è¨­å®šã‚’è¡¨ç¤º/éè¡¨ç¤º
                if (gameMode === 'sequence') {
                    sequenceSettings.classList.add('show');
                } else {
                    sequenceSettings.classList.remove('show');
                }
            });
        });

        // æ˜‡é †/é™é †é¸æŠ
        ascendingBtn.addEventListener('click', () => {
            document.querySelectorAll('.direction-btn').forEach(b => b.classList.remove('selected'));
            ascendingBtn.classList.add('selected');
            sequenceDirection = 'ascending';
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®š
            startNumberInput.value = '0';
            endNumberInput.value = '9';
        });

        descendingBtn.addEventListener('click', () => {
            document.querySelectorAll('.direction-btn').forEach(b => b.classList.remove('selected'));
            descendingBtn.classList.add('selected');
            sequenceDirection = 'descending';
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šï¼ˆé™é †ç”¨ï¼‰
            startNumberInput.value = '100';
            endNumberInput.value = '0';
        });

        // é–‹å§‹æ•°å­—ãŒå¤‰æ›´ã•ã‚ŒãŸã‚‰çµ‚äº†æ•°å­—ã‚‚è‡ªå‹•èª¿æ•´
        startNumberInput.addEventListener('change', () => {
            const start = parseInt(startNumberInput.value);
            if (sequenceDirection === 'ascending') {
                // æ˜‡é †ã®å ´åˆã€çµ‚äº†æ•°å­—ã¯é–‹å§‹ã‚ˆã‚Šå¤§ãã„å€¤
                if (parseInt(endNumberInput.value) <= start) {
                    endNumberInput.value = Math.min(start + 10, maxNumber);
                }
            } else {
                // é™é †ã®å ´åˆã€çµ‚äº†æ•°å­—ã¯é–‹å§‹ã‚ˆã‚Šå°ã•ã„å€¤
                if (parseInt(endNumberInput.value) >= start) {
                    endNumberInput.value = Math.max(start - 10, 0);
                }
            }
        });

        // é›£æ˜“åº¦é¸æŠ
        document.querySelectorAll('.difficulty-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                // dataset.difficultyãŒå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿å‡¦ç†ï¼ˆæ˜‡é †/é™é †ãƒœã‚¿ãƒ³ã‚’é™¤å¤–ï¼‰
                if (!btn.dataset.difficulty) return;
                
                document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                difficulty = btn.dataset.difficulty;
                maxNumber = difficultySettings[difficulty].max;
                
                // é–‹å§‹/çµ‚äº†æ•°å­—ã®æœ€å¤§å€¤ã‚’æ›´æ–°
                startNumberInput.max = maxNumber;
                endNumberInput.max = maxNumber;
                
                // æ˜‡é †ã®å ´åˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤èª¿æ•´
                if (sequenceDirection === 'ascending') {
                    if (parseInt(startNumberInput.value) > maxNumber) {
                        startNumberInput.value = 0;
                    }
                    if (parseInt(endNumberInput.value) > maxNumber) {
                        endNumberInput.value = maxNumber;
                    }
                } else {
                    // é™é †ã®å ´åˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤èª¿æ•´
                    if (parseInt(startNumberInput.value) > maxNumber) {
                        startNumberInput.value = maxNumber;
                    }
                }
            });
        });

        function playSound(frequency, duration, type = 'sine') {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }

        // æ•°å­—ã«å¿œã˜ãŸå‡§ã®è¡¨ç¤ºæ•°ã‚’è¨ˆç®—
        function getTargetTakoCount(number) {
            if (gameMode !== 'sequence') {
                return 1;
            }
            
            // ä¸€æ¡ã®æ•°ã ã‘å‡§ã‚’è¡¨ç¤ºï¼ˆ0ã®å ´åˆã¯1å€‹ï¼‰
            const onesDigit = number % 10;
            return onesDigit === 0 ? 1 : onesDigit;
        }

        function startGame() {
            if (gameActive) return;
            
            gameActive = true;
            score = 0;
            combo = 0;
            level = 1;
            currentInput = '';
            takos = [];
            
            // ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ãŸåˆæœŸåŒ–
            if (gameMode === 'sequence') {
                // é †ç•ªãƒ¢ãƒ¼ãƒ‰
                timeLeft = 0; // æ™‚é–“åˆ¶é™ãªã—
                startNumber = parseInt(startNumberInput.value) || 0;
                endNumber = parseInt(endNumberInput.value) || (sequenceDirection === 'ascending' ? maxNumber : 0);
                sequenceNumber = startNumber;
                
                // æ–¹å‘ã«å¿œã˜ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                const directionText = sequenceDirection === 'ascending' ? 'â†’' : 'â†';
                instruction.textContent = `æ•°å­— ${sequenceNumber} ã®å‡§ã‚’æ¢ãã†ï¼ (${startNumber}${directionText}${endNumber})`;
            } else {
                // ã‚¿ã‚¤ãƒ ã‚¢ã‚¿ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰
                timeLeft = 60;
                instruction.textContent = 'æ•°å­—ã‚’å…¥åŠ›ã—ã¦å‡§ã‚’æ’ƒã¡è½ã¨ã›ï¼';
            }
            
            updateDisplay();
            startBtn.disabled = true;
            difficultySelector.style.display = 'none';
            
            // å‡§ã‚’å®šæœŸçš„ã«ç”Ÿæˆ
            const spawnRate = gameMode === 'sequence' ? 500 : difficultySettings[difficulty].spawnRate;
            spawnInterval = setInterval(spawnTako, spawnRate);
            
            // ã‚¿ã‚¤ãƒãƒ¼ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¿ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã®ã¿ï¼‰
            if (gameMode === 'timeattack') {
                gameInterval = setInterval(() => {
                    timeLeft--;
                    updateDisplay();
                    
                    if (timeLeft <= 0) {
                        endGame();
                    }
                    
                    // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—
                    const newLevel = Math.floor(score / 30) + 1;
                    if (newLevel > level) {
                        level = newLevel;
                        levelDisplay.textContent = level;
                        playSound(600, 0.3, 'triangle');
                        showMessage('ãƒ¬ãƒ™ãƒ« ' + level + 'ï¼');
                    }
                }, 1000);
            }
            
            // åˆæœŸã®å‡§ã‚’ã„ãã¤ã‹ç”Ÿæˆ
            if (gameMode === 'sequence') {
                const targetCount = getTargetTakoCount(sequenceNumber);
                for (let i = 0; i < targetCount; i++) {
                    setTimeout(() => spawnTako(), i * 300);
                }
            } else {
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => spawnTako(), i * 800);
                }
            }
        }

        function endGame() {
            gameActive = false;
            clearInterval(gameInterval);
            clearInterval(spawnInterval);
            
            // ã™ã¹ã¦ã®å‡§ã‚’å‰Šé™¤
            takos.forEach(tako => {
                if (tako.element && tako.element.parentNode) {
                    tako.element.remove();
                }
            });
            takos = [];
            
            let finalMessage = '';
            if (gameMode === 'sequence') {
                let numbersCleared;
                let totalNumbers;
                if (sequenceDirection === 'ascending') {
                    numbersCleared = sequenceNumber - startNumber;
                    totalNumbers = endNumber - startNumber + 1;
                } else {
                    numbersCleared = startNumber - sequenceNumber;
                    totalNumbers = startNumber - endNumber + 1;
                }
                
                if (numbersCleared >= totalNumbers) {
                    finalMessage = 'ğŸ‰ å®Œç’§ï¼å…¨éƒ¨ã‚¯ãƒªã‚¢ï¼ ğŸ‰';
                } else {
                    finalMessage = `ğŸŒŸ ${numbersCleared}å€‹ã®æ•°å­—ã‚’ã‚¯ãƒªã‚¢ï¼`;
                }
            } else {
                if (score >= 100) {
                    finalMessage = 'ğŸ† å‡§æšã’åäººï¼ã™ã”ã„ï¼ ğŸ†';
                } else if (score >= 70) {
                    finalMessage = 'ğŸŒŸ ã¨ã£ã¦ã‚‚ã™ã°ã‚‰ã—ã„ï¼';
                } else if (score >= 40) {
                    finalMessage = 'ğŸ‘ ã‚ˆãã§ãã¾ã—ãŸï¼';
                } else {
                    finalMessage = 'ğŸ˜Š ãŒã‚“ã°ã‚Šã¾ã—ãŸï¼';
                }
            }
            
            showMessage(finalMessage + '<br>ã‚¹ã‚³ã‚¢: ' + score + 'ç‚¹', true);
            startBtn.disabled = false;
            startBtn.textContent = 'ğŸ® ã‚‚ã†ä¸€åº¦';
            difficultySelector.style.display = 'block';
            instruction.textContent = 'å‡§ã«æ›¸ã‹ã‚ŒãŸæ•°å­—ã‚’ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§å…¥åŠ›ã—ã¦ã­ï¼';
        }

        function resetGame() {
            gameActive = false;
            clearInterval(gameInterval);
            clearInterval(spawnInterval);
            
            takos.forEach(tako => {
                if (tako.element && tako.element.parentNode) {
                    tako.element.remove();
                }
            });
            takos = [];
            
            score = 0;
            timeLeft = 60;
            combo = 0;
            level = 1;
            currentInput = '';
            sequenceNumber = 0;
            
            // è¡¨ç¤ºã‚’åˆæœŸåŒ–ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¿ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã«æˆ»ã™ï¼‰
            gameMode = 'timeattack';
            sequenceDirection = 'ascending';
            scoreBox.innerHTML = 'ã‚¹ã‚³ã‚¢: <span id="score">0</span>';
            timeBox.innerHTML = 'æ™‚é–“: <span id="time">60</span>ç§’';
            
            // ãƒ¢ãƒ¼ãƒ‰é¸æŠãƒœã‚¿ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('selected'));
            document.querySelector('.mode-btn[data-mode="timeattack"]').classList.add('selected');
            sequenceSettings.classList.remove('show');
            
            // æ˜‡é †/é™é †ãƒœã‚¿ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.querySelectorAll('.direction-btn').forEach(b => b.classList.remove('selected'));
            ascendingBtn.classList.add('selected');
            startNumberInput.value = '0';
            endNumberInput.value = '9';
            
            updateDisplay();
            startBtn.disabled = false;
            startBtn.textContent = 'ğŸ® ã‚¹ã‚¿ãƒ¼ãƒˆ';
            difficultySelector.style.display = 'block';
            instruction.textContent = 'å‡§ã«æ›¸ã‹ã‚ŒãŸæ•°å­—ã‚’ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§å…¥åŠ›ã—ã¦ã­ï¼';
            messageBox.classList.remove('show');
        }

        function updateDisplay() {
            if (gameMode === 'sequence') {
                // é †ç•ªãƒ¢ãƒ¼ãƒ‰ã§ã¯é€²æ—ã‚’è¡¨ç¤º
                let progress, total;
                if (sequenceDirection === 'ascending') {
                    progress = sequenceNumber - startNumber;
                    total = endNumber - startNumber + 1;
                } else {
                    progress = startNumber - sequenceNumber;
                    total = startNumber - endNumber + 1;
                }
                scoreBox.innerHTML = `é€²æ—: <strong>${progress}/${total}</strong>`;
                
                // ä¸€æ¡ã®æ•°ã‚’è¡¨ç¤º
                const onesDigit = sequenceNumber % 10;
                const takoCount = onesDigit === 0 ? 1 : onesDigit;
                timeBox.innerHTML = `æ¬¡: <strong id="time">${sequenceNumber}</strong> (Ã—${takoCount})`;
            } else {
                // ã‚¿ã‚¤ãƒ ã‚¢ã‚¿ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã‚¹ã‚³ã‚¢ã¨æ™‚é–“ã‚’è¡¨ç¤º
                scoreBox.innerHTML = `ã‚¹ã‚³ã‚¢: <strong id="score">${score}</strong>`;
                timeBox.innerHTML = `æ™‚é–“: <strong id="time">${timeLeft}</strong>ç§’`;
            }
            
            comboDisplay.textContent = combo;
            levelDisplay.textContent = level;
        }

        function spawnTako() {
            if (!gameActive) return;
            
            // ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ã¦æ•°å­—ã‚’æ±ºå®š
            let number;
            let shouldSpawn = true;
            
            if (gameMode === 'sequence') {
                // é †ç•ªãƒ¢ãƒ¼ãƒ‰ï¼šç¾åœ¨ã®é †ç•ªã®æ•°å­—ã®ã¿
                number = sequenceNumber;
                
                // ç¯„å›²ãƒã‚§ãƒƒã‚¯
                if (sequenceDirection === 'ascending') {
                    if (sequenceNumber > endNumber) {
                        return;
                    }
                } else {
                    if (sequenceNumber < endNumber) {
                        return;
                    }
                }
                
                // æ—¢ã«å¿…è¦ãªæ•°ã®å‡§ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯ç”Ÿæˆã—ãªã„
                const targetCount = getTargetTakoCount(sequenceNumber);
                const existingCount = takos.filter(t => t.number === sequenceNumber).length;
                if (existingCount >= targetCount) {
                    return;
                }
            } else {
                // ã‚¿ã‚¤ãƒ ã‚¢ã‚¿ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ï¼šãƒ©ãƒ³ãƒ€ãƒ 
                number = Math.floor(Math.random() * (maxNumber + 1));
            }
            
            const colors = [
                'linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 50%, #c44569 100%)',
                'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)'
            ];
            
            const tako = document.createElement('div');
            tako.className = 'tako';
            
            // é †ç•ªãƒ¢ãƒ¼ãƒ‰ã§è¤‡æ•°å‡§ã®å ´åˆã¯é…ç½®ã‚’èª¿æ•´
            let leftPos;
            if (gameMode === 'sequence') {
                const existingCount = takos.filter(t => t.number === number).length;
                const targetCount = getTargetTakoCount(number);
                
                // ç”»é¢ã‚’å‡ç­‰ã«åˆ†å‰²ã—ã¦é…ç½®
                if (targetCount > 1) {
                    const spacing = (window.innerWidth - 240) / targetCount;
                    leftPos = spacing * existingCount + 60;
                } else {
                    leftPos = (window.innerWidth - 120) / 2;
                }
            } else {
                leftPos = Math.random() * (window.innerWidth - 120);
            }
            
            tako.style.left = leftPos + 'px';
            tako.style.top = '-200px';
            
            const body = document.createElement('div');
            body.className = 'tako-body';
            body.style.background = colors[Math.floor(Math.random() * colors.length)];
            
            const pattern = document.createElement('div');
            pattern.className = 'tako-pattern';
            pattern.textContent = number;
            
            const string = document.createElement('div');
            string.className = 'tako-string';
            
            const tail = document.createElement('div');
            tail.className = 'tako-tail';
            for (let i = 0; i < 3; i++) {
                const piece = document.createElement('div');
                piece.className = 'tail-piece';
                tail.appendChild(piece);
            }
            
            body.appendChild(pattern);
            tako.appendChild(body);
            tako.appendChild(string);
            tako.appendChild(tail);
            takosContainer.appendChild(tako);
            
            const takoObj = {
                element: tako,
                number: number,
                y: -200,
                targetY: Math.random() * 200 + 100,
                speed: difficultySettings[difficulty].speed
            };
            
            takos.push(takoObj);
            
            tako.addEventListener('click', () => {
                if (gameActive) {
                    captureTako(takoObj);
                }
            });
        }

        function animateTakos() {
            takos.forEach((tako, index) => {
                if (!tako.element || !tako.element.parentNode) {
                    takos.splice(index, 1);
                    return;
                }
                
                if (tako.y < tako.targetY) {
                    tako.y += tako.speed * 0.3;
                } else {
                    tako.y += Math.sin(Date.now() * 0.001 + index) * 0.5;
                }
                
                tako.element.style.top = tako.y + 'px';
            });
            
            if (gameActive) {
                requestAnimationFrame(animateTakos);
            }
        }

        function captureTako(tako) {
            const capturedNumber = tako.number;
            
            // é †ç•ªãƒ¢ãƒ¼ãƒ‰ã§ã¯åŒã˜æ•°å­—ã®å‡§ã‚’å…¨ã¦å–å¾—
            let takosToCapture = [tako];
            if (gameMode === 'sequence') {
                takosToCapture = takos.filter(t => t.number === capturedNumber);
            }
            
            const points = 10 + combo * 2 + (level - 1) * 5;
            score += points;
            combo++;
            
            updateDisplay();
            playSound(400 + combo * 50, 0.2, 'sine');
            
            // å…¨ã¦ã®å‡§ã‚’å‰Šé™¤ã—ã¦ã‚¨ãƒ•ã‚§ã‚¯ãƒˆè¡¨ç¤º
            takosToCapture.forEach((t, idx) => {
                // ã‚¹ã‚³ã‚¢ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ï¼ˆæœ€åˆã®å‡§ã ã‘ï¼‰
                if (idx === 0) {
                    const popup = document.createElement('div');
                    popup.className = 'score-popup';
                    popup.textContent = '+' + points;
                    popup.style.left = t.element.offsetLeft + 60 + 'px';
                    popup.style.top = t.element.offsetTop + 'px';
                    document.body.appendChild(popup);
                    setTimeout(() => popup.remove(), 1000);
                }
                
                // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ï¼ˆå…¨ã¦ã®å‡§ã§è¡¨ç¤ºï¼‰
                setTimeout(() => {
                    createParticles(t.element.offsetLeft + 60, t.element.offsetTop + 60);
                    t.element.remove();
                }, idx * 100); // å°‘ã—ãšã¤æ™‚é–“å·®ã§æ¶ˆãˆã‚‹
            });
            
            // é…åˆ—ã‹ã‚‰ä¸€æ‹¬å‰Šé™¤
            takosToCapture.forEach(t => {
                const index = takos.indexOf(t);
                if (index > -1) {
                    takos.splice(index, 1);
                }
            });
            
            // é †ç•ªãƒ¢ãƒ¼ãƒ‰ã§ã¯æ¬¡ã®æ•°å­—ã¸é€²ã‚€
            if (gameMode === 'sequence') {
                // åŒã˜æ•°å­—ã®å‡§ã¯å…¨ã¦æ¶ˆãˆãŸã®ã§ã€å¿…ãš0ã«ãªã‚‹
                const remainingSameTakos = 0;
                
                if (remainingSameTakos === 0) {
                    // æ¬¡ã®æ•°å­—ã¸
                    if (sequenceDirection === 'ascending') {
                        sequenceNumber++;
                    } else {
                        sequenceNumber--;
                    }
                    
                    // çµ‚äº†æ¡ä»¶ãƒã‚§ãƒƒã‚¯
                    let isFinished = false;
                    if (sequenceDirection === 'ascending') {
                        isFinished = sequenceNumber > endNumber;
                    } else {
                        isFinished = sequenceNumber < endNumber;
                    }
                    
                    if (isFinished) {
                        setTimeout(() => {
                            endGame();
                            showMessage('ğŸ‰ ã™ã¹ã¦ã®æ•°å­—ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸï¼ ğŸ‰<br>ã‚¹ã‚³ã‚¢: ' + score + 'ç‚¹', true);
                        }, 500);
                    } else {
                        const directionText = sequenceDirection === 'ascending' ? 'â†’' : 'â†';
                        instruction.textContent = `æ•°å­— ${sequenceNumber} ã®å‡§ã‚’æ¢ãã†ï¼ (${startNumber}${directionText}${endNumber})`;
                        // æ¬¡ã®å‡§ã‚’ç”Ÿæˆ
                        setTimeout(() => {
                            const targetCount = getTargetTakoCount(sequenceNumber);
                            for (let i = 0; i < targetCount; i++) {
                                setTimeout(() => spawnTako(), i * 200);
                            }
                        }, 300);
                    }
                    
                    // ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ˆé †ç•ªãƒ¢ãƒ¼ãƒ‰ã§ã¯10å€‹ã”ã¨ï¼‰
                    const progress = Math.abs(sequenceNumber - startNumber);
                    if (progress % 10 === 0 && progress > 0) {
                        level++;
                        levelDisplay.textContent = level;
                        playSound(600, 0.3, 'triangle');
                        showMessage('ãƒ¬ãƒ™ãƒ« ' + level + 'ï¼');
                    }
                }
            }
        }

        function createParticles(x, y) {
            const colors = ['#ff6b6b', '#4facfe', '#43e97b', '#fa709a', '#ffd93d'];
            for (let i = 0; i < 15; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle-explosion';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                document.body.appendChild(particle);
                
                const angle = (Math.PI * 2 * i) / 15;
                const velocity = 50 + Math.random() * 50;
                const vx = Math.cos(angle) * velocity;
                const vy = Math.sin(angle) * velocity;
                
                let posX = x;
                let posY = y;
                let opacity = 1;
                let velocityY = vy;
                
                const animation = setInterval(() => {
                    posX += vx * 0.1;
                    posY += velocityY * 0.1;
                    velocityY += 2; // é‡åŠ›
                    opacity -= 0.03;
                    
                    particle.style.left = posX + 'px';
                    particle.style.top = posY + 'px';
                    particle.style.opacity = opacity;
                    
                    if (opacity <= 0 || posY > window.innerHeight) {
                        clearInterval(animation);
                        particle.remove();
                    }
                }, 16);
            }
        }

        function showMessage(text, persist = false) {
            messageText.innerHTML = text;
            messageBox.classList.add('show');
            if (!persist) {
                setTimeout(() => {
                    messageBox.classList.remove('show');
                }, 1500);
            }
        }

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›
        document.addEventListener('keydown', (e) => {
            if (!gameActive) return;
            
            if (e.key >= '0' && e.key <= '9') {
                currentInput += e.key;
                
                if (gameMode === 'sequence') {
                    const directionText = sequenceDirection === 'ascending' ? 'â†’' : 'â†';
                    instruction.textContent = `æ•°å­— ${sequenceNumber} ã®å‡§ã‚’æ¢ãã†ï¼ (${startNumber}${directionText}${endNumber}) [å…¥åŠ›: ${currentInput}]`;
                } else {
                    instruction.textContent = 'å…¥åŠ›ä¸­: ' + currentInput;
                }
                
                // å…¥åŠ›ã•ã‚ŒãŸæ•°å­—ã¨ä¸€è‡´ã™ã‚‹å‡§ã‚’æ¢ã™
                const inputNumber = parseInt(currentInput);
                
                let matchingTako;
                if (gameMode === 'sequence') {
                    // é †ç•ªãƒ¢ãƒ¼ãƒ‰ã§ã¯ç¾åœ¨ã®é †ç•ªã®æ•°å­—ã®ã¿ãƒãƒƒãƒ
                    matchingTako = takos.find(t => t.number === inputNumber && t.number === sequenceNumber);
                } else {
                    // ã‚¿ã‚¤ãƒ ã‚¢ã‚¿ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã§ã¯ä»»æ„ã®æ•°å­—
                    matchingTako = takos.find(t => t.number === inputNumber);
                }
                
                if (matchingTako) {
                    captureTako(matchingTako);
                    currentInput = '';
                } else {
                    // é †ç•ªãƒ¢ãƒ¼ãƒ‰ã§ã¯ã€ç›®æ¨™ã®æ•°å­—ä»¥å¤–ã¯å³ã‚¨ãƒ©ãƒ¼
                    if (gameMode === 'sequence') {
                        if (inputNumber !== sequenceNumber && !sequenceNumber.toString().startsWith(currentInput)) {
                            currentInput = '';
                            const directionText = sequenceDirection === 'ascending' ? 'â†’' : 'â†';
                            instruction.textContent = `é•ã†ã‚ˆï¼æ•°å­— ${sequenceNumber} ã‚’æ¢ãã†ï¼`;
                            combo = 0;
                            updateDisplay();
                            playSound(200, 0.2, 'sawtooth');
                            setTimeout(() => {
                                if (gameActive) {
                                    instruction.textContent = `æ•°å­— ${sequenceNumber} ã®å‡§ã‚’æ¢ãã†ï¼ (${startNumber}${directionText}${endNumber})`;
                                }
                            }, 1000);
                        }
                    } else {
                        // ã‚¿ã‚¤ãƒ ã‚¢ã‚¿ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ï¼šç¾åœ¨ã®å…¥åŠ›ã§å§‹ã¾ã‚‹æ•°å­—ãŒãªã„å ´åˆã¯ãƒªã‚»ãƒƒãƒˆ
                        const possibleMatch = takos.some(t => 
                            t.number.toString().startsWith(currentInput)
                        );
                        
                        if (!possibleMatch) {
                            currentInput = '';
                            instruction.textContent = 'ãã®æ•°å­—ã®å‡§ã¯ãªã„ã‚ˆï¼';
                            combo = 0;
                            updateDisplay();
                            playSound(200, 0.2, 'sawtooth');
                            setTimeout(() => {
                                if (gameActive) {
                                    instruction.textContent = 'æ•°å­—ã‚’å…¥åŠ›ã—ã¦å‡§ã‚’æ’ƒã¡è½ã¨ã›ï¼';
                                }
                            }, 1000);
                        }
                    }
                }
            } else if (e.key === 'Backspace') {
                currentInput = currentInput.slice(0, -1);
                if (gameMode === 'sequence') {
                    const directionText = sequenceDirection === 'ascending' ? 'â†’' : 'â†';
                    instruction.textContent = currentInput ? 
                        `æ•°å­— ${sequenceNumber} ã®å‡§ã‚’æ¢ãã†ï¼ (${startNumber}${directionText}${endNumber}) [å…¥åŠ›: ${currentInput}]` : 
                        `æ•°å­— ${sequenceNumber} ã®å‡§ã‚’æ¢ãã†ï¼ (${startNumber}${directionText}${endNumber})`;
                } else {
                    instruction.textContent = currentInput ? 'å…¥åŠ›ä¸­: ' + currentInput : 'æ•°å­—ã‚’å…¥åŠ›ã—ã¦å‡§ã‚’æ’ƒã¡è½ã¨ã›ï¼';
                }
            } else if (e.key === 'Escape') {
                currentInput = '';
                if (gameMode === 'sequence') {
                    const directionText = sequenceDirection === 'ascending' ? 'â†’' : 'â†';
                    instruction.textContent = `æ•°å­— ${sequenceNumber} ã®å‡§ã‚’æ¢ãã†ï¼ (${startNumber}${directionText}${endNumber})`;
                } else {
                    instruction.textContent = 'æ•°å­—ã‚’å…¥åŠ›ã—ã¦å‡§ã‚’æ’ƒã¡è½ã¨ã›ï¼';
                }
            }
        });

        startBtn.addEventListener('click', () => {
            startGame();
            animateTakos();
        });
        
        resetBtn.addEventListener('click', resetGame);
    </script>
</body>
</html>

